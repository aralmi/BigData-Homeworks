# Домашнее задание 2: Анализ поездок посредством Spark DataFrame API

## Описание

Анализ системы велошеринга **Citibike** в Нью-Йорке - определение популярных зон и визуализация через интерактивные картограммы (Choropleth maps).

## Данные

- **Поездки:** 18,565 поездок (февраль 2019)
- **Станции:** 52 велостанции
- **Зоны:** 263 таксономические зоны NYC Taxi Zones
- **Проблема:** Все станции находятся в **Jersey City** (Нью-Джерси), а не в Нью-Йорке!

### Результаты сопоставления:

```
ТОП ЗОНЫ ПО КОЛИЧЕСТВУ ПОЕЗДОК:

1. Governor's Island/Ellis Island/Liberty Island
   Начала:   ~20,000+
   Окончания: ~20,000+
   Всего:    ~40,000+ (66% от всех!)

2. Battery Park City
   Начала:   757
   Окончания: 904
   Всего:    1,661 (9%)

3. Hudson Sq
   Начала:   368 + 760
   Окончания: 426 + 737
   Всего:    2,291 (12%)

4. West Chelsea/Hudson Yards
   Начала:   102
   Окончания: 91
   Всего:    193 (1%)
```

## Технический процесс

### 1. Загрузка и парсинг данных
```python
# Данные о поездках
tripduration, starttime, stoptime
start station (ID, name, lat, lng)
end station (ID, name, lat, lng)
usertype, birth year, gender
```

### 2. Агрегация по станциям
```
Для каждой станции вычислено:
- start_count: число начала поездок
- end_count: число окончания поездок
- Всего: start_count + end_count
```

### 3. Пространственное сопоставление (GIS)
```python
# Метод: Ближайшей точки (Nearest Neighbor)
Используется: GeoPandas + Shapely
- Для каждой станции найти ближайшую зону
- Приписать всю активность этой зоне
```

### 4. Картография (Choropleth)
```python
# Создание интерактивной карты
folium + GeoJSON
- Цвет зоны = интенсивность поездок
- Всплывающие подсказки с числами
- Зум и панорамирование
```

## Ключевые выводы

1. **Концентрация спроса:** Велошеринг очень сконцентрирован географически
2. **Граничные эффекты:** Данные из Jersey City исказили анализ
3. **Ближайшие соседи:** Для сопоставления нужно использовать **point-in-polygon** алгоритм, а не ближайшие соседи
4. **Визуализация:** Choropleth эффективна для показа пространственных паттернов

